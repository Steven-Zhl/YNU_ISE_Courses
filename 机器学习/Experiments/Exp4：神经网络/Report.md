# 实验四：神经网络

> $author@Steven$

## 目录

* [实验四：神经网络](#实验四神经网络)
  * [目录](#目录)
  * [1. 线性回归模型](#1-线性回归模型)
    * [1.1 题目分析](#11-题目分析)
    * [1.2 解题步骤](#12-解题步骤)
    * [1.3 结果分析](#13-结果分析)
  * [2. 逻辑回归模型](#2-逻辑回归模型)
    * [2.1 题目分析](#21-题目分析)
    * [2.2 解题步骤](#22-解题步骤)
    * [2.3 结果分析](#23-结果分析)

## 1. 线性回归模型

    本任务中你将使用一元线性回归来预测食厅的利润。假设你是一家特许餐厅的首席执行官，正在考虑在不同的城市开设一家新的分店。该连锁店已经在不同的城市有分店，你有这些城市的利润和人口数据。你希望使用这些数据来帮助您选择下一个要扩展到的城市。
    文件 ex1data.csv 包含我们的线性回归问题的数据集。Population 代表一个城市的人口，profit 代表此个城市的餐厅利润。利润的负值表示亏损。

* 请使用pytorch搭建一个三层神经网络，构建回归模型，选择合适的损失函数，使用反向传播来优化模型参数，记录模型训练过程损失。请留出20%作为测试集评估模型，并分析结果

### 1.1 题目分析

* 由于本题与实验1完全相同，只是换了种方法，所以问题分析就不必赘述。
  * 神经网络属于力大砖飞的算法，是一个对大多数问题都有用的通解，而这正是实际工业中所需要的；而数学类算法则需要针对具体问题设计具体的算法。
  * 划分训练集和测试集时调用了`torch.utils.data.random_split()`即随机划分，因此同一个代码每次跑的结果都不一样，如果效果欠佳建议多跑几次。
    * 此外可能由于样本量不够大，训练集无法代表整个数据集，因此模型在测试集上的效果不甚理想。试了一下，优化器选择`torch.optim.Adam`时效果相对较好。当然也可以自己换一换，能跑出来更好看的图当然更好。

### 1.2 解题步骤

* 搭建网络模型
  * 自己构建一个类，继承自`torch.nn.Module`。
  * 在`__init__()`方法中调用父类的`__init__()`方法，然后在其中定义网络结构。
  * 重写`forward()`方法，定义前向传播过程。
* 为训练模型做准备：数据预处理，并划分训练集和测试集。然后实例化模型、损失函数和优化器。
* 训练模型：设定`epoch`上限，然后在每个`epoch`中将所有训练样本输入模型，计算损失，然后反向传播，更新模型参数。具体步骤大致如下：
  * 遍历每个样本的`X_train`和`y_train`
  * 将`X_train`输入给模型，得到当前模型的输出值`output`
  * 根据预先设定好的损失函数、预测值`output`和实际值`y_train`计算损失`loss`
  * 将`loss`反向传播，然后利用优化器更新模型参数
* 当`epoch`结束后，即可得到训练完成的模型。随后按照类似的方式，将测试集输入模型，计算模型在测试集上的`loss`，以评估模型的泛化能力。

### 1.3 结果分析

* ![Regression loss.png](./IMG/Regression%20loss.png)
  * 纵轴表示均方误差，每个epoch都分别计算当前模型在训练集和测试集上的均方误差。
  * 可以看出来均方误差两者最终都稳定在20以下，已经收敛了。

## 2. 逻辑回归模型

    本任务中你将建立一个逻辑回归模型来预测一个学生是否被大学录取。假设你是一所大学系的管理员，你想根据两次考试的成绩来决定每个申请人的录取机会。你有以前申请者的历史数据，可以用作逻辑回归的训练集。对于每个培训示例，你都有申请人在两次考试中的分数和录取决定。你的任务是建立一个分类模型，根据这两次考试的分数来估计申请人的录取概率。
    文件 ex1data2.csv 包含我们的逻辑回归问题的数据集,学生的两门成绩 Exam1，Exam2 和是否被录取 Accepted(1 为录取，0 为未录取)，请利用逻辑回归知识根据学生成绩判断学生是否会被录取，并将结果可视化。 

### 2.1 题目分析

* 略

### 2.2 解题步骤

* 与上题非常类似，只不过在模型定义中换成了4层线性网络，此外损失函数采用`torch.nn.CrossEntropyLoss()`，并且为适应这两处改动对应部分略有变化，其余部分均与上题相同。
* 此外感叹一下`torch`封装程度如此高，调用起来还是很方便的。

### 2.3 结果分析

* ![Classification loss.png](./IMG/Classification%20loss.png)
  * 纵轴表示均方误差，每个epoch都分别计算当前模型在训练集和测试集上的均方误差。
  * 可以看出来均方误差两者最终都稳定在20以下，已经收敛了。

> 此外这两题每次迭代的数据都已经保存到两个csv文件中了，可以康康。